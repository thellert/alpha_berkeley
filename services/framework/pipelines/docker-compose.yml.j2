services:
  pipelines:
    image: ghcr.io/open-webui/pipelines:main
    # build:
    #   context: ./pipelines
    #   dockerfile: Dockerfile
    container_name: pipelines
    restart: unless-stopped
    ports:
      - {{framework.services.pipelines.port_host}}:{{framework.services.pipelines.port_container}} # Expose pipeline port
    volumes:
      - ./framework/pipelines:/pipelines 
      - {{project_root}}/{{file_paths.agent_data_dir}}:/app/{{file_paths.agent_data_dir}}
    environment:
      # Tell pipelines where to find the scripts within the container
      - PIPELINES_DIR=/pipelines/interfaces/openwebui 
      - PIPELINES_REQUIREMENTS_PATH=/pipelines/repo_src/requirements.txt 
      # Default API key for local dev (can be changed)
      - PIPELINES_API_KEY=0p3n-w3bu!
      # Python path points to source directory for clean imports
      - PYTHONPATH=/pipelines/repo_src
      # Python executable path for local execution mode (container-specific override)
      - CONTAINER_PYTHON_ENV=/usr/local/bin/python3
      # Enable colored output in container
      - TERM=xterm-256color
      - COLORTERM=truecolor
      - FORCE_COLOR=1 
      # External API keys
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY}
      - GEMINI_API_KEY=${GEMINI_API_KEY}
      - CBORG_API_KEY=${CBORG_API_KEY}
      # SQUID proxy
      - HTTP_PROXY=${HTTP_PROXY}
      - HTTPS_PROXY=${HTTPS_PROXY}
      - http_proxy=${http_proxy}
      - https_proxy=${https_proxy}
      - NO_PROXY=${NO_PROXY}
      # Langfuse
      - LANGFUSE_SECRET_KEY=${LANGFUSE_SECRET_KEY}
      - LANGFUSE_PUBLIC_KEY=${LANGFUSE_PUBLIC_KEY}
    networks:
      - als-agents-network