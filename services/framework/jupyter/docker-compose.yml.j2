services:
  # Read EPICS Container (Read-Only + Simulation)
  jupyter-read:
    container_name: jupyter-read
    build:
      context: ./framework/jupyter
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "{{framework.services.jupyter.containers.read.port_host}}:{{framework.services.jupyter.containers.read.port_container}}"
    volumes:
      - ./framework/jupyter:/jupyter
      - {{project_root}}/{{file_paths.agent_data_dir}}/{{file_paths.executed_python_scripts_dir}}:/home/jovyan/work/executed_scripts/
      # Mount safe kernels only
      - ./framework/jupyter/python3-epics-readonly:/opt/conda/share/jupyter/kernels/python3-epics-readonly
      - ./framework/jupyter/python3-epics-simulation:/opt/conda/share/jupyter/kernels/python3-epics-simulation
    environment:
      - NOTEBOOK_DIR=/home/jovyan/work
      - JUPYTER_ENABLE_LAB=yes
      - PYTHONPATH=/jupyter/repo_src
      - HTTP_PROXY=${HTTP_PROXY}
      - NO_PROXY=${NO_PROXY}
      # EPICS Read Container Configuration (kernels define specific gateways)
      - EPICS_CA_AUTO_ADDR_LIST=NO
      - EPICS_EXECUTION_MODE=read
    command: ["/bin/bash", "/jupyter/custom_start.sh"]
    networks:
      - als-agents-network

  # Write Access EPICS Container (DANGEROUS - DEV ONLY)
  jupyter-write:
    container_name: jupyter-write
    build:
      context: ./framework/jupyter
      dockerfile: Dockerfile
    restart: unless-stopped
    ports:
      - "{{framework.services.jupyter.containers.write.port_host}}:{{framework.services.jupyter.containers.write.port_container}}"
    volumes:
      - ./framework/jupyter:/jupyter
      - {{project_root}}/{{file_paths.agent_data_dir}}/{{file_paths.executed_python_scripts_dir}}:/home/jovyan/work/executed_scripts/
      # Mount all kernels (full flexibility in write container)
      - ./framework/jupyter/python3-epics-readonly:/opt/conda/share/jupyter/kernels/python3-epics-readonly
      - ./framework/jupyter/python3-epics-simulation:/opt/conda/share/jupyter/kernels/python3-epics-simulation
      - ./framework/jupyter/python3-epics-write:/opt/conda/share/jupyter/kernels/python3-epics-write
    environment:
      - NOTEBOOK_DIR=/home/jovyan/work
      - JUPYTER_ENABLE_LAB=yes
      - PYTHONPATH=/jupyter/repo_src
      - HTTP_PROXY=${HTTP_PROXY}
      - NO_PROXY=${NO_PROXY}
      # EPICS Write Access Configuration (kernels define specific gateways)
      - EPICS_CA_AUTO_ADDR_LIST=NO
      - EPICS_EXECUTION_MODE=write_access
      - EPICS_WRITE_ACCESS=development
    command: ["/bin/bash", "/jupyter/custom_start.sh"]
    networks:
      - als-agents-network