services:
  # Read EPICS Container (Read-Only + Simulation)
  jupyter-read:
    container_name: jupyter-read
    build:
      context: ./jupyter
      dockerfile: Dockerfile
    restart: "no"
    ports:
      - "{{services.jupyter.containers.read.port_host}}:{{services.jupyter.containers.read.port_container}}"
    volumes:
      - ./jupyter:/jupyter
      - {{project_root}}/{{file_paths.agent_data_dir}}/{{file_paths.executed_python_scripts_dir}}:/home/jovyan/work/executed_scripts/
      # Mount safe kernels only
      - ./jupyter/python3-epics-readonly:/opt/conda/share/jupyter/kernels/python3-epics-readonly
    environment:
      - NOTEBOOK_DIR=/home/jovyan/work
      - JUPYTER_ENABLE_LAB=yes
      - PYTHONPATH=/jupyter/repo_src
      # Timezone synchronization with host (from system configuration)
      - TZ={{system.timezone}}
      # Proxy settings (optional - uncomment if behind corporate firewall)
      # - HTTP_PROXY=${HTTP_PROXY}
      # - NO_PROXY=${NO_PROXY}
      # EPICS Read Container Configuration (kernels define specific gateways)
      - EPICS_CA_AUTO_ADDR_LIST=NO
      - EPICS_EXECUTION_MODE=read
    command: ["/bin/bash", "/jupyter/custom_start.sh"]
    networks:
      - osprey-network

  # Write Access EPICS Container (DANGEROUS - DEV ONLY)
  jupyter-write:
    container_name: jupyter-write
    build:
      context: ./jupyter
      dockerfile: Dockerfile
    restart: "no"
    ports:
      - "{{services.jupyter.containers.write.port_host}}:{{services.jupyter.containers.write.port_container}}"
    volumes:
      - ./jupyter:/jupyter
      - {{project_root}}/{{file_paths.agent_data_dir}}/{{file_paths.executed_python_scripts_dir}}:/home/jovyan/work/executed_scripts/
      # Mount all kernels (full flexibility in write container)
      - ./jupyter/python3-epics-readonly:/opt/conda/share/jupyter/kernels/python3-epics-readonly
      - ./jupyter/python3-epics-write:/opt/conda/share/jupyter/kernels/python3-epics-write
    environment:
      - NOTEBOOK_DIR=/home/jovyan/work
      - JUPYTER_ENABLE_LAB=yes
      # Timezone synchronization with host (from system configuration)
      - TZ={{system.timezone}}
      # Proxy settings (optional - uncomment if behind corporate firewall)
      # - HTTP_PROXY=${HTTP_PROXY}
      # - NO_PROXY=${NO_PROXY}
      # EPICS Write Access Configuration (kernels define specific gateways)
      - EPICS_CA_AUTO_ADDR_LIST=NO
      - EPICS_EXECUTION_MODE=write_access
      - EPICS_WRITE_ACCESS=development
    command: ["/bin/bash", "/jupyter/custom_start.sh"]
    networks:
      - osprey-network